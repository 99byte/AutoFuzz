# AutoFuzz 安装指南

## 系统要求

### 必需软件
- **Node.js** 18+ 
- **Python** 3.10+
- **ADB** (Android Debug Bridge)
- **Git**

### 硬件要求
- 一台已启用开发者模式的Android手机（Android 7.0+）
- USB数据线（支持数据传输）
- 电脑操作系统：macOS / Linux / Windows (WSL2推荐)

---

## 快速安装

### 1. 克隆项目

```bash
git clone <repository-url>
cd AutoFuzz
```

### 2. 运行初始化脚本

```bash
chmod +x scripts/setup.sh
./scripts/setup.sh
```

脚本将自动完成：
- ✅ 检查系统依赖
- ✅ 安装Node.js依赖
- ✅ 初始化数据库
- ✅ 添加Git submodule
- ✅ 创建Python虚拟环境
- ✅ 安装AutoGLM
- ✅ 创建环境变量文件

---

## 手动安装步骤

如果您想手动安装，请按照以下步骤操作：

### 步骤1：安装Node.js依赖

```bash
npm install
```

### 步骤2：初始化数据库

```bash
npx prisma migrate dev --name init
```

### 步骤3：添加Git Submodule

```bash
git submodule add https://github.com/zai-org/Open-AutoGLM.git vendor/Open-AutoGLM
git submodule update --init --recursive
```

### 步骤4：创建Python虚拟环境

```bash
# macOS/Linux
python3 -m venv autoglm-env
source autoglm-env/bin/activate

# Windows
python -m venv autoglm-env
autoglm-env\Scripts\activate
```

### 步骤5：安装AutoGLM

```bash
pip install -e ./vendor/Open-AutoGLM
```

验证安装：

```bash
python -c "import phone_agent; print('✅ AutoGLM安装成功')"
```

### 步骤6：配置环境变量

```bash
cp .env.example .env.local
```

编辑 `.env.local` 文件，填写智谱API Key：

```env
# 数据库
DATABASE_URL="file:./prisma/dev.db"

# 智谱AI配置
ZHIPU_API_KEY="your-zhipu-api-key"
GLM_MODEL="glm-4"

# AutoGLM配置
AUTOGLM_BASE_URL="https://open.bigmodel.cn/api/paas/v4"
AUTOGLM_MODEL="autoglm-phone"

# 应用配置
NEXT_PUBLIC_APP_NAME="AutoFuzz"
NEXT_PUBLIC_APP_URL="http://localhost:3000"
```

---

## 获取智谱AI API Key

1. 访问 [智谱AI开放平台](https://open.bigmodel.cn/)
2. 注册并登录账号
3. 进入控制台 → API Key管理
4. 创建新的API Key
5. 将API Key复制到 `.env.local` 文件中

---

## 配置Android设备

### 启用开发者模式

1. 打开手机「设置」
2. 进入「关于手机」
3. 连续点击「版本号」7次，直到提示"开发者模式已启用"

### 启用USB调试

1. 进入「设置」→「开发者选项」
2. 启用「USB调试」
3. 部分机型还需要启用「USB调试（安全设置）」

### 连接手机

1. 使用USB数据线连接手机和电脑
2. 手机上会弹出"允许USB调试"对话框，点击「允许」
3. 验证连接：

```bash
adb devices
```

应该看到类似输出：

```
List of devices attached
XXXXXXXX    device
```

---

## 安装ADB（如果未安装）

### macOS

```bash
brew install android-platform-tools
```

### Linux

```bash
sudo apt-get install android-tools-adb
```

### Windows

1. 下载 [Android Platform Tools](https://developer.android.com/tools/releases/platform-tools)
2. 解压到某个目录（如 `C:\platform-tools`）
3. 将该目录添加到系统PATH环境变量

---

## 验证安装

运行以下命令验证所有组件是否正常安装：

```bash
# 1. 检查Node.js
node --version
npm --version

# 2. 检查Python
python3 --version

# 3. 检查ADB
adb devices

# 4. 检查AutoGLM
source autoglm-env/bin/activate  # Windows: autoglm-env\Scripts\activate
python -c "import phone_agent; print('✅ AutoGLM')"
deactivate

# 5. 启动开发服务器
npm run dev
```

---

## 常见问题

### Q1: `adb devices` 没有输出？

**解决方案：**
1. 检查USB数据线是否支持数据传输
2. 检查手机上是否允许了USB调试
3. 尝试更换USB接口或数据线
4. 运行 `adb kill-server && adb start-server`

### Q2: AutoGLM导入失败？

**解决方案：**
```bash
source autoglm-env/bin/activate
pip install -e ./vendor/Open-AutoGLM
```

### Q3: 数据库迁移失败？

**解决方案：**
```bash
rm -f prisma/dev.db prisma/migrations/*
npx prisma migrate dev --name init
```

### Q4: 智谱API调用失败？

**解决方案：**
1. 检查 `.env.local` 中的API Key是否正确
2. 检查网络连接
3. 确认智谱账号有足够的配额

### Q5: Python虚拟环境创建失败？

**解决方案：**
```bash
# macOS/Linux
python3 -m venv autoglm-env

# Windows
python -m venv autoglm-env
```

---

## 下一步

安装完成后，请查看：
- [使用说明](./使用说明.md) - 学习如何使用AutoFuzz
- [开发文档](./开发文档.md) - 了解如何开发

启动应用：

```bash
npm run dev
```

访问 http://localhost:3000 开始使用！
