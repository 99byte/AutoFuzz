# AutoFuzz 使用说明

## 快速开始

### 1. 启动应用

```bash
npm run dev
```

访问 http://localhost:3000

---

## 创建Fuzz任务

### 步骤1：进入创建页面

点击首页的「创建任务」按钮，或访问 http://localhost:3000/create-task

### 步骤2：填写任务信息

| 字段 | 说明 | 示例 |
|------|------|------|
| 任务名称 | 描述性名称 | 微信压力测试 |
| 应用包名 | Android应用包名 | com.tencent.mm |
| 应用描述 | 应用的功能和特点 | 微信是一款社交通讯应用，支持聊天、朋友圈、小程序等功能 |
| 测试深度 | 生成测试用例的数量 | 10 |
| 重点关注区域 | AI会重点测试的功能 | 登录, 浏览, 支付 |

### 步骤3：启动测试

创建任务后，进入任务详情页面，点击「启动测试」按钮。

---

## 监控测试执行

### 实时查看

任务详情页面提供实时监控功能：

- **测试进度**：显示当前执行的测试用例
- **崩溃次数**：检测到的崩溃数量
- **完成率**：测试完成百分比
- **执行日志**：实时滚动显示执行日志

### 日志类型

| 类型 | 说明 |
|------|------|
| `task_started` | 任务开始执行 |
| `test_cases_generated` | 测试用例生成完成 |
| `test_case_started` | 开始执行某个测试用例 |
| `action_completed` | 动作执行完成 |
| `crash_detected` | 检测到崩溃 |
| `task_completed` | 任务完成 |
| `task_failed` | 任务失败 |

---

## 查看测试结果

测试完成后，可以查看：

### 测试摘要

- 总测试用例数
- 成功用例数
- 失效用例数
- 崩溃次数
- 总执行时间

### 崩溃报告

每个崩溃记录包含：

- 崩溃类型（Native崩溃 / Java异常 / ANR / 进程死亡）
- 堆栈跟踪
- 崩溃时间
- 日志片段

---

## 测试用例类型

AI生成的测试用例包含以下操作类型：

| 操作类型 | 说明 | 示例 |
|---------|------|------|
| Launch | 启动应用 | 打开微信 |
| Tap | 点击元素 | 点击登录按钮 |
| Type | 输入文本 | 输入手机号 |
| Swipe | 滑动 | 向下滑动列表 |
| Back | 返回上一页 | 返回 |
| Home | 返回桌面 | 返回桌面 |
| LongPress | 长按 | 长按删除按钮 |
| Wait | 等待 | 等待2秒 |

---

## 最佳实践

### 1. 应用描述

提供详细的应用描述有助于生成更好的测试用例：

```
✅ 好的描述：
微信是一款社交通讯应用，主要功能包括：
- 单聊和群聊
- 朋友圈分享
- 微信支付
- 小程序

用户可以发送文字、图片、语音消息，进行语音/视频通话。
```

```
❌ 差的描述：
微信是一个聊天软件
```

### 2. 重点关注区域

指定要重点测试的功能：

- 对于社交应用：聊天、朋友圈、支付
- 对于电商应用：浏览商品、购物车、下单、支付
- 对于新闻应用：浏览新闻、评论、分享

### 3. 测试深度

| 场景 | 推荐测试深度 |
|------|-------------|
| 首次测试 | 5-10 |
| 常规测试 | 10-20 |
| 深度测试 | 20-50 |

### 4. 设备准备

- 确保手机电量充足
- 关闭不必要的应用
- 确保网络连接稳定
- 测试前清空应用数据（可选）

---

## 停止测试

正在运行的测试可以随时停止：

1. 进入任务详情页面
2. 点击「停止测试」按钮
3. 测试将立即终止，已执行的结果会保存

---

## 测试流程说明

完整的Fuzz测试流程如下：

```
1. 用户创建任务
   ↓
2. AI生成测试用例（使用智谱GLM-4）
   ↓
3. 启动测试
   ↓
4. 开始崩溃监控（ADB Logcat）
   ↓
5. 依次执行测试用例
   ↓
6. 每个测试用例包含多个UI操作
   ↓
7. 实时推送执行进度
   ↓
8. 保存执行结果
   ↓
9. 生成测试报告
```

---

## 崩溃检测机制

AutoFuzz通过以下方式检测应用崩溃：

### 1. Native崩溃
- 搜索Logcat中的 "FATAL EXCEPTION" 关键字
- 捕获崩溃堆栈跟踪

### 2. Java异常
- 检测 "AndroidRuntime" 中的异常
- 捕获Java堆栈跟踪

### 3. ANR (Application Not Responding)
- 检测 "ANR" 关键字
- 读取ANR traces文件

### 4. 进程死亡
- 通过 `pidof` 检查进程是否存在
- 如果进程意外退出，记录为崩溃

---

## API接口

### 获取任务列表

```bash
GET /api/tasks
```

### 创建任务

```bash
POST /api/tasks
Content-Type: application/json

{
  "name": "测试任务",
  "targetApp": "com.example.app",
  "appDescription": "应用描述",
  "testConfig": {
    "testDepth": 10,
    "focusAreas": ["登录", "浏览"]
  }
}
```

### 启动测试

```bash
POST /api/tasks/{id}/start
```

### 停止测试

```bash
POST /api/tasks/{id}/stop
```

### 获取实时流

```bash
GET /api/tasks/{id}/stream
```

返回Server-Sent Events (SSE)流。

---

## 故障排除

### 问题1：任务启动失败

**可能原因：**
- 手机未连接
- ADB权限问题
- 智谱API Key无效

**解决方案：**
```bash
# 检查设备
adb devices

# 检查环境变量
cat .env.local

# 查看服务器日志
# 终端会显示错误信息
```

### 问题2：没有检测到崩溃

**可能原因：**
- 崩溃检测逻辑不完善
- 应用异常退出但未生成日志

**解决方案：**
- 检查Logcat日志：`adb logcat -d`
- 手动触发崩溃测试

### 问题3：测试用例执行很慢

**可能原因：**
- 测试深度设置过大
- 应用启动时间长
- 网络延迟

**解决方案：**
- 减少测试深度
- 使用更快的设备
- 稳定的网络连接

---

## 下一步

- [开发文档](./开发文档.md) - 了解如何开发新功能
- [安装指南](./安装指南.md) - 重新安装或升级

---

## 获取帮助

如有问题，请：
1. 查看本文档的故障排除部分
2. 检查[安装指南](./安装指南.md)
3. 查看服务器日志输出

祝测试顺利！ 🚀
